{"version":3,"sources":["../../../../../src/spet/data/explorer/MetadataExplorer.js"],"names":["metadata","properties","width","type","defaultValue","height","origins","modelName","undefined","aggregations","_graph","multiple","visibility","events","detail","dom","entityType","init","setAggregation","Graph","directed","attachModelContextChange","sName","getModelName","oComponent","Component","getOwnerComponentFor","oModel","getModel","build","oMeta","getMetaModel","fnLabel","oMdlCtxt","createBindingContext","sPath","AnnotationHelper","format","getProperty","fnFqName","oEnt","namespace","name","loaded","then","aSchemas","aEntities","concat","jQuery","map","m","aAssocs","association","oGraph","getAggregation","removeAllNodes","removeAllLinks","each","i","addNode","KeyNode","key","label","getODataEntityType","oA","addLink","KeyLink","sourceKey","end","targetKey","updateOrigins","setOrigins","aOrigins","setProperty","getOrigins","length","getNodes","oN","setOrigin","indexOf","getKey","setExpanded","setExpandable","renderer","oRM","oControl","write","writeControlData","addStyle","getHeight","getWidth","writeStyles","renderControl"],"mappings":";;AAQA;;;;;;;;;;;;AASCA,U,EAAW;AACVC,eAAY;AACX;;;;;;AAMAC,WAAO,EAAEC,MAAM,qBAAR,EAA+BC,cAAc,MAA7C,EAPI;;AASX;;;;;;AAMAC,YAAQ,EAAEF,MAAM,qBAAR,EAA+BC,cAAc,MAA7C,EAfG;;AAiBX;;;;;;;AAOAE,aAAS,EAAEH,MAAM,UAAR,EAAoBC,cAAc,EAAlC,EAxBE;;AA0BX;;;;;;AAMAG,eAAW,EAAEJ,MAAM,QAAR,EAAkBC,cAAcI,SAAhC;AAhCA,IADF;AAmCVC,iBAAc;AACb;;;;;;AAMAC,YAAQ,EAAEP,MAAM,0BAAR,EAAoCQ,UAAU,KAA9C,EAAqDC,YAAY,QAAjE;AAPK,IAnCJ;AA4CVC,WAAQ;AACP;;;;;;;AAOAC,YAAQ;AACPC,UAAK,EAAEZ,MAAM,QAAR,EADE;AAEPa,iBAAY,EAAEb,MAAM,QAAR;AAFL;AARD;AA5CE,G;AA2DXc,M,kBAAO;AAAA;;AACN,QAAKC,cAAL,CAAoB,QAApB,EAA8B,IAAIC,KAAJ,CAAU,EAAEC,UAAU,KAAZ,EAAV,CAA9B;AACA,QAAKC,wBAAL,CAA8B,YAAM;AACnC,QAAIC,QAAQ,MAAKC,YAAL,EAAZ;AAAA,QACCC,aAAaC,UAAUC,oBAAV,OADd;AAAA,QAECC,SAAS,MAAKC,QAAL,CAAcN,KAAd,KAAyBE,cAAcA,WAAWI,QAAX,CAAoBN,KAApB,CAFjD;AAGA,QAAIK,MAAJ,EAAY;AACX,WAAKE,KAAL,CAAWF,MAAX;AACA;AACD,IAPD;AAQA,G;AASDE,O,iBAAMF,M,EAAQ;AAAA;;AACb,OAAIG,QAAQH,UAAUA,OAAOI,YAAP,EAAtB;AAAA,OACCC,UAAU,SAAVA,OAAU,QAAS;AAClB,QAAIC,WAAWH,MAAMI,oBAAN,CAA2BC,QAAQ,uCAAnC,CAAf;AACA,WAAQF,YAAYG,iBAAiBC,MAAjB,CAAwBJ,QAAxB,CAAb,IAAmDH,MAAMQ,WAAN,CAAkBH,QAAQ,OAA1B,CAA1D;AACA,IAJF;AAAA,OAKCI,WAAW,SAAXA,QAAW;AAAA,WAAQC,KAAKC,SAAL,GAAiB,GAAjB,GAAuBD,KAAKE,IAApC;AAAA,IALZ;AAMAZ,SAAMa,MAAN,GAAeC,IAAf,CAAoB,YAAM;AAAA;;AACzB,QAAIC,WAAWf,MAAMQ,WAAN,CAAkB,sBAAlB,KAA6C,EAA5D;AAAA,QACCQ,YAAY,YAAGC,MAAH,gCAAaC,OAAOC,GAAP,CAAWJ,QAAX,EAAqB;AAAA,YAAKK,EAAElC,UAAF,IAAgB,EAArB;AAAA,KAArB,CAAb,EADb;AAAA,QAECmC,UAAU,aAAGJ,MAAH,iCAAaC,OAAOC,GAAP,CAAWJ,QAAX,EAAqB;AAAA,YAAKK,EAAEE,WAAF,IAAiB,EAAtB;AAAA,KAArB,CAAb,EAFX;AAAA,QAGCC,SAAS,OAAKC,cAAL,CAAoB,QAApB,CAHV;AAIAD,WAAOE,cAAP;AACAF,WAAOG,cAAP;AACAR,WAAOS,IAAP,CAAYX,SAAZ,EAAuB,UAACY,CAAD,EAAIlB,IAAJ;AAAA,YAAaa,OAAOM,OAAP,CAAe,IAAIC,OAAJ,CAAY;AAC9DC,WAAKtB,SAASC,IAAT,CADyD;AAE9DsB,aAAO9B,QAAQF,MAAMiC,kBAAN,CAAyBxB,SAASC,IAAT,CAAzB,EAAyC,IAAzC,CAAR;AAFuD,MAAZ,CAAf,CAAb;AAAA,KAAvB;AAIAQ,WAAOS,IAAP,CAAYN,OAAZ,EAAqB,UAACO,CAAD,EAAIM,EAAJ;AAAA,YAAWX,OAAOY,OAAP,CAAe,IAAIC,OAAJ,CAAY;AAC1DC,iBAAWH,GAAGI,GAAH,CAAO,CAAP,EAAUjE,IADqC;AAE1DkE,iBAAWL,GAAGI,GAAH,CAAO,CAAP,EAAUjE;AAFqC,MAAZ,CAAf,CAAX;AAAA,KAArB;AAIA,WAAKmE,aAAL;AACA,IAhBD;AAiBA,G;AAEDC,Y,sBAAWC,Q,EAAU;AACpB,QAAKC,WAAL,CAAiB,SAAjB,EAA4BD,QAA5B;AACA,QAAKF,aAAL;AACA,G;AAQDA,e,2BAAgB;AACf,OAAIE,WAAW,KAAKE,UAAL,MAAqB,EAApC;AAAA,OACCrB,SAAS,KAAKC,cAAL,CAAoB,QAApB,CADV;AAEA,OAAIkB,SAASG,MAAb,EAAqB;AACpB3B,WAAOS,IAAP,CAAYJ,OAAOuB,QAAP,MAAqB,EAAjC,EAAqC,UAAClB,CAAD,EAAImB,EAAJ,EAAW;AAC/CA,QAAGC,SAAH,CAAaN,SAASO,OAAT,CAAiBF,GAAGG,MAAH,EAAjB,KAAiC,CAA9C;AACAH,QAAGI,WAAH,CAAe,KAAf;AACAJ,QAAGK,aAAH,CAAiB,IAAjB;AACA,KAJD;AAKA,IAND,MAMO;AACNlC,WAAOS,IAAP,CAAYJ,OAAOuB,QAAP,MAAqB,EAAjC,EAAqC,UAAClB,CAAD,EAAImB,EAAJ,EAAW;AAC/CA,QAAGC,SAAH,CAAa,IAAb;AACAD,QAAGI,WAAH,CAAe,IAAf;AACAJ,QAAGK,aAAH,CAAiB,KAAjB;AACA,KAJD;AAKA;AACD,G;AASDC,U,oBAASC,G,EAAKC,Q,EAAU;AACvBD,OAAIE,KAAJ,CAAU,MAAV;AACAF,OAAIG,gBAAJ,CAAqBF,QAArB;AACAD,OAAII,QAAJ,CAAa,QAAb,EAAuBH,SAASI,SAAT,EAAvB;AACAL,OAAII,QAAJ,CAAa,OAAb,EAAsBH,SAASK,QAAT,EAAtB;AACAN,OAAIO,WAAJ;AACAP,OAAIE,KAAJ,CAAU,GAAV;AACAF,OAAIQ,aAAJ,CAAkBP,SAAS/B,cAAT,CAAwB,QAAxB,CAAlB;AACA8B,OAAIE,KAAJ,CAAU,QAAV;AACA","file":"MetadataExplorer.js","sourceRoot":"src","sourcesContent":["import jQuery from \"jquery.sap.global\";\nimport Control from \"sap/ui/core/Control\";\nimport Component from \"sap/ui/core/Component\";\nimport AnnotationHelper from \"sap/ui/model/odata/AnnotationHelper\";\nimport Graph from \"./Graph\";\nimport KeyNode from \"./KeyNode\";\nimport KeyLink from \"./KeyLink\";\n\n/**\n * Control for exploring the metadata of an OData model.\n * This control is based on an underlying Graph.\n * Each entity type is represented through a node and each\n * association through a link.\n * @class\n * @name spet.data.explorer.MetadataExplorer\n */\nexport default class MetadataExplorer extends Control {\n\tmetadata = {\n\t\tproperties: {\n\t\t\t/**\n\t\t\t * The width of the control.\n\t\t\t * @type {sap.ui.core.CSSSize}\n\t\t\t * @default \"100%\"\n\t\t\t * @name spet.data.explorer.MetadataExplorer#width\n\t\t\t */\n\t\t\twidth: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\n\n\t\t\t/**\n\t\t\t * The height of the control.\n\t\t\t * @type {sap.ui.core.CSSSize}\n\t\t\t * @default \"100%\"\n\t\t\t * @name spet.data.explorer.MetadataExplorer#height\n\t\t\t */\n\t\t\theight: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\n\n\t\t\t/**\n\t\t\t * An array of fully qualified entity names which should serve as roots.\n\t\t\t * If no entities are given, then all the entities are considered to be roots.\n\t\t\t * @type {string[]}\n\t\t\t * @default []\n\t\t\t * @name spet.data.explorer.MetadataExplorer#origins\n\t\t\t */\n\t\t\torigins: { type: \"string[]\", defaultValue: [] },\n\n\t\t\t/**\n\t\t\t * The name of the OData model whose metadata should be used.\n\t\t\t * @type {string}\n\t\t\t * @default undefined\n\t\t\t * @name spet.data.explorer.MetadataExplorer#modelName\n\t\t\t */\n\t\t\tmodelName: { type: \"string\", defaultValue: undefined }\n\t\t},\n\t\taggregations: {\n\t\t\t/**\n\t\t\t * The undelying graph.\n\t\t\t * @private\n\t\t\t * @type {spet.data.explorer.Graph}\n\t\t\t * @name spet.data.explorer.MetadataExplorer#_graph\n\t\t\t */\n\t\t\t_graph: { type: \"spet.data.explorer.Graph\", multiple: false, visibility: \"hidden\" }\n\t\t},\n\t\tevents: {\n\t\t\t/**\n\t\t\t * Fired when details are requested for a node (context menu request).\n\t\t\t * @event\n\t\t\t * @name spet.data.explorer.MetadataExplorer#detail\n\t\t\t * @property {object} dom The DOM reference of the node.\n\t\t\t * @property {string} entityType The fully qualified entity type name.\n\t\t\t */\n\t\t\tdetail: {\n\t\t\t\tdom: { type: \"object\" },\n\t\t\t\tentityType: { type: \"string\" }\n\t\t\t}\n\t\t}\n\t}\n\n\tinit() {\n\t\tthis.setAggregation(\"_graph\", new Graph({ directed: false }));\n\t\tthis.attachModelContextChange(() => {\n\t\t\tlet sName = this.getModelName(),\n\t\t\t\toComponent = Component.getOwnerComponentFor(this),\n\t\t\t\toModel = this.getModel(sName) || (oComponent && oComponent.getModel(sName));\n\t\t\tif (oModel) {\n\t\t\t\tthis.build(oModel);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Builds the nodes and links for a given ODataModel.\n\t * @method spet.data.explorer.MetadataExplorer#build\n\t * @protected\n\t * @param {sap.ui.model.odata.v2.ODataModel} oModel The OData model.\n\t * @returns {void}\n\t */\n\tbuild(oModel) {\n\t\tvar oMeta = oModel && oModel.getMetaModel(),\n\t\t\tfnLabel = sPath => {\n\t\t\t\tlet oMdlCtxt = oMeta.createBindingContext(sPath + \"/com.sap.vocabularies.Common.v1.Label\");\n\t\t\t\treturn (oMdlCtxt && AnnotationHelper.format(oMdlCtxt)) || oMeta.getProperty(sPath + \"/name\");\n\t\t\t},\n\t\t\tfnFqName = oEnt => oEnt.namespace + \".\" + oEnt.name;\n\t\toMeta.loaded().then(() => {\n\t\t\tvar aSchemas = oMeta.getProperty(\"/dataServices/schema\") || [],\n\t\t\t\taEntities = [].concat(...jQuery.map(aSchemas, m => m.entityType || [])),\n\t\t\t\taAssocs = [].concat(...jQuery.map(aSchemas, m => m.association || [])),\n\t\t\t\toGraph = this.getAggregation(\"_graph\");\n\t\t\toGraph.removeAllNodes();\n\t\t\toGraph.removeAllLinks();\n\t\t\tjQuery.each(aEntities, (i, oEnt) => oGraph.addNode(new KeyNode({\n\t\t\t\tkey: fnFqName(oEnt),\n\t\t\t\tlabel: fnLabel(oMeta.getODataEntityType(fnFqName(oEnt), true))\n\t\t\t})));\n\t\t\tjQuery.each(aAssocs, (i, oA) => oGraph.addLink(new KeyLink({\n\t\t\t\tsourceKey: oA.end[0].type,\n\t\t\t\ttargetKey: oA.end[1].type\n\t\t\t})));\n\t\t\tthis.updateOrigins();\n\t\t});\n\t}\n\n\tsetOrigins(aOrigins) {\n\t\tthis.setProperty(\"origins\", aOrigins);\n\t\tthis.updateOrigins();\n\t}\n\n\t/**\n\t * Updates the nodes of the graph based on the origins property.\n\t * @method spet.data.explorer.MetadataExplorer#updateOrigins\n\t * @protected\n\t * @returns {void}\n\t */\n\tupdateOrigins() {\n\t\tvar aOrigins = this.getOrigins() || [],\n\t\t\toGraph = this.getAggregation(\"_graph\");\n\t\tif (aOrigins.length) {\n\t\t\tjQuery.each(oGraph.getNodes() || [], (i, oN) => {\n\t\t\t\toN.setOrigin(aOrigins.indexOf(oN.getKey()) >= 0);\n\t\t\t\toN.setExpanded(false);\n\t\t\t\toN.setExpandable(true);\n\t\t\t});\n\t\t} else {\n\t\t\tjQuery.each(oGraph.getNodes() || [], (i, oN) => {\n\t\t\t\toN.setOrigin(true);\n\t\t\t\toN.setExpanded(true);\n\t\t\t\toN.setExpandable(false);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * The renderer of the control. Wraps the graph inside a DIV.\n\t * @ignore\n\t * @param {sap.ui.core.RenderManager} oRM The render manager.\n\t * @param {sap.ui.core.Control} oControl The explorer.\n\t * @returns {void}\n\t */\n\trenderer(oRM, oControl) {\n\t\toRM.write(\"<div\");\n\t\toRM.writeControlData(oControl);\n\t\toRM.addStyle(\"height\", oControl.getHeight());\n\t\toRM.addStyle(\"width\", oControl.getWidth());\n\t\toRM.writeStyles();\n\t\toRM.write(\">\");\n\t\toRM.renderControl(oControl.getAggregation(\"_graph\"));\n\t\toRM.write(\"</div>\");\n\t}\n}"]}