{"version":3,"sources":["../../../../../src/spet/data/explorer/ODataExplorer.js"],"names":["metadata","properties","width","type","defaultValue","height","path","modelName","undefined","growingThreshold","aggregations","_graph","multiple","visibility","events","addEntity","entityPath","node","addNavigation","navigationName","detailEntity","dom","detailNavigation","_modelPromise","_link","oGraph","sSource","sTarget","sLabel","oLink","ODataLink","sourceKey","targetKey","label","addLink","_aggregation","oModel","sPath","sNavigation","sFull","oBinding","bindList","initialize","iIndex","iCount","getGrowingThreshold","oDeferred","jQuery","Deferred","oMoreNode","oMoreLink","fnLink","oChild","getKey","fnNode","oNode","ODataNode","key","expanded","entity","attachEvent","fireEvent","oE","getParameter","addNode","resolve","fnChildren","each","aContexts","ii","oC","_entity","getPath","then","fnMore","iLength","setBusy","removeNode","removeLink","sMoreKey","sap","ui","getCore","getLibraryResourceBundle","getText","expand","fnRequest","fnData","getLength","destroy","getContexts","oResult","dataRequested","attachDataReceived","promise","bOrigin","oMeta","getMetaModel","fnTitle","oMetaCtxt","getMetaContext","sAnnotationPath","oMdlCtxt","createBindingContext","AnnotationHelper","format","getProperty","fnNavigationLabel","sMetaPath","fnRelated","oBarrier","oPromise","when","fnExpand","oEvent","oEntity","getObject","getSource","aPromises","map","navigationProperty","oNav","i","oAssoc","getODataAssociationEnd","name","multiplicity","indexOf","fnAdd","oContext","setKey","setEntity","fnCreate","origin","bindElement","setModel","attachEventOnce","getElementBinding","fnCheck","getBoundContext","loaded","init","setAggregation","Graph","directed","attachModelContextChange","sName","getModelName","oComponent","Component","getOwnerComponentFor","getModel","setPath","getAggregation","removeAllAggregation","setProperty","renderer","oRM","oControl","write","writeControlData","addStyle","getHeight","getWidth","writeStyles","renderControl"],"mappings":"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","file":"ODataExplorer.js","sourceRoot":"src","sourcesContent":["import jQuery from \"jquery.sap.global\";\nimport Control from \"sap/ui/core/Control\";\nimport Component from \"sap/ui/core/Component\";\nimport AnnotationHelper from \"sap/ui/model/odata/AnnotationHelper\";\nimport Graph from \"./Graph\";\nimport ODataNode from \"./ODataNode\";\nimport ODataLink from \"./ODataLink\";\n\n/**\n * Control for exploring the content of an OData model.\n * This explorer starts from a single entity root node.\n * Each node can either be an entity or a multi-cardinality\n * navigation.\n * @class\n * @name spet.data.explorer.ODataExplorer\n */\nexport default class ODataExplorer extends Control {\n\tmetadata = {\n\t\tproperties: {\n\t\t\t/**\n\t\t\t * The width of the control.\n\t\t\t * @type {sap.ui.core.CSSSize}\n\t\t\t * @default \"100%\"\n\t\t\t * @name spet.data.explorer.ODataExplorer#width\n\t\t\t */\n\t\t\twidth: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\n\n\t\t\t/**\n\t\t\t * The height of the control.\n\t\t\t * @type {sap.ui.core.CSSSize}\n\t\t\t * @default \"100%\"\n\t\t\t * @name spet.data.explorer.ODataExplorer#height\n\t\t\t */\n\t\t\theight: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\n\n\t\t\t/**\n\t\t\t * The path of the root entity.\n\t\t\t * @type {string}\n\t\t\t * @name spet.data.explorer.ODataExplorer#path\n\t\t\t */\n\t\t\tpath: { type: \"string\", defaultValue: \"\" },\n\n\t\t\t/**\n\t\t\t * The name of the OData model whose metadata should be used.\n\t\t\t * @type {string}\n\t\t\t * @default undefined\n\t\t\t * @name spet.data.explorer.ODataExplorer#modelName\n\t\t\t */\n\t\t\tmodelName: { type: \"string\", defaultValue: undefined },\n\n\t\t\t/**\n\t\t\t * The maximum number of entities from a multi-cardinality\n\t\t\t * navigation which should be loaded at once. If further\n\t\t\t * entities are available, a specialized \"More\" node is\n\t\t\t * shown.\n\t\t\t * @type {int}\n\t\t\t * @default 20\n\t\t\t * @name spet.data.explorer.ODataExplorer#growingThreshold\n\t\t\t */\n\t\t\tgrowingThreshold: { type: \"int\", defaultValue: 20 }\n\t\t},\n\t\taggregations: {\n\t\t\t/**\n\t\t\t * The undelying graph.\n\t\t\t * @private\n\t\t\t * @type {spet.data.explorer.Graph}\n\t\t\t * @name spet.data.explorer.ODataExplorer#_graph\n\t\t\t */\n\t\t\t_graph: { type: \"spet.data.explorer.Graph\", multiple: false, visibility: \"hidden\" }\n\t\t},\n\t\tevents: {\n\t\t\t/**\n\t\t\t * Fired before an entity is added to the explorer.\n\t\t\t * Preventing the default of this event will cause the explorer to not add the node.\n\t\t\t * @event\n\t\t\t * @name spet.data.explorer.ODataExplorer#addEntity\n\t\t\t * @property {string} entityPath The model path of the entity.\n\t\t\t * @property {spet.data.explorer.Node} node The new node.\n\t\t\t */\n\t\t\taddEntity: {\n\t\t\t\tentityPath: { type: \"string\" },\n\t\t\t\tnode: { type: \"spet.data.explorer.Node\" }\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fired before a mutiple-cardinality navigation of an entity is added to the explorer.\n\t\t\t * Preventing the default of this event will cause the explorer to not add the node.\n\t\t\t * @event\n\t\t\t * @name spet.data.explorer.ODataExplorer#addNavigation\n\t\t\t * @property {string} navigationName The name of the navigation property.\n\t\t\t * @property {string} entityPath The model path of the entity.\n\t\t\t */\n\t\t\taddNavigation: {\n\t\t\t\tnavigationName: { type: \"string\" },\n\t\t\t\tentityPath: { type: \"string\" }\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fired when details are requested for an entity node (context menu request).\n\t\t\t * @event\n\t\t\t * @name spet.data.explorer.ODataExplorer#detailEntity\n\t\t\t * @property {object} dom The DOM reference of the node.\n\t\t\t * @property {string} entityType The fully qualified entity type name.\n\t\t\t */\n\t\t\tdetailEntity: {\n\t\t\t\tdom: { type: \"object\" },\n\t\t\t\tentityPath: { type: \"string\" }\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Fired when details are requested for a navigation node (context menu request).\n\t\t\t * @event\n\t\t\t * @name spet.data.explorer.ODataExplorer#detailNavigation\n\t\t\t * @property {object} dom The DOM reference of the node.\n\t\t\t * @property {string} navigationName The name of the navigation property.\n\t\t\t * @property {string} entityType The fully qualified entity type name.\n\t\t\t */\n\t\t\tdetailNavigation: {\n\t\t\t\tdom: { type: \"object\" },\n\t\t\t\tnavigationName: { type: \"string\" },\n\t\t\t\tentityPath: { type: \"string\" }\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Promise which is resolved when the model is available.\n\t * @private\n\t * @name spet.data.explorer.ODataExplorer#_modelPromise\n\t */\n\t_modelPromise = null\n\n\t/**\n\t * Links two nodes.\n\t * @private\n\t * @method spet.data.explorer.ODataExplorer#_link\n\t * @param {spet.data.explorer.Graph} oGraph The graph control.\n\t * @param {string} sSource The source node key.\n\t * @param {string} sTarget The target node key.\n\t * @param {string=} sLabel An optional label to be shown on the link.\n\t * @returns {spet.data.explorer.ODataLink} The created link.\n\t */\n\t_link(oGraph, sSource, sTarget, sLabel) {\n\t\tlet oLink = new ODataLink({\n\t\t\tsourceKey: sSource,\n\t\t\ttargetKey: sTarget,\n\t\t\tlabel: sLabel || \"\"\n\t\t});\n\t\toGraph.addLink(oLink);\n\t\treturn oLink;\n\t}\n\n\t/**\n\t * Adds an aggregation node for a multiple-cardinality navigation of an entity.\n\t * @private\n\t * @method spet.data.explorer.ODataExplorer#_aggregation\n\t * @param {sap.ui.model.odata.v2.ODataModel} oModel The OData model.\n\t * @param {spet.data.explorer.Graph} oGraph The Graph control.\n\t * @param {string} sPath The path towards the owner entity.\n\t * @param {string} sNavigation The navigation name.\n\t * @param {string=} sLabel The label to be displayed on the link.\n\t * @returns {Promise} A promise resolved when the node is added to the graph.\n\t */\n\t_aggregation(oModel, oGraph, sPath, sNavigation, sLabel) {\n\t\tlet sFull = sPath + \"/\" + sNavigation,\n\t\t\toBinding = oModel.bindList(sFull).initialize(),\n\t\t\tiIndex = 0,\n\t\t\tiCount = this.getGrowingThreshold(),\n\t\t\toDeferred = new jQuery.Deferred(),\n\t\t\toMoreNode,\n\t\t\toMoreLink;\n\n\t\tlet fnLink = oChild => oChild && this._link(oGraph, sFull, oChild.getKey());\n\n\t\t/**\n\t\t * Creates the navigation node.\n\t\t * @ignore\n\t\t */\n\t\tlet fnNode = () => {\n\t\t\tlet oNode = new ODataNode({\n\t\t\t\tkey: sFull,\n\t\t\t\texpanded: true,\n\t\t\t\tlabel: sLabel,\n\t\t\t\tentity: sPath\n\t\t\t});\n\t\t\toNode.attachEvent(\"detail\", oE => {\n\t\t\t\tthis.fireEvent(\"detailNavigation\", {\n\t\t\t\t\tdom: oE.getParameter(\"dom\"),\n\t\t\t\t\tentityPath: sPath,\n\t\t\t\t\tnavigationName: sNavigation\n\t\t\t\t});\n\t\t\t});\n\t\t\toGraph.addNode(oNode);\n\t\t\toDeferred.resolve(oNode);\n\t\t};\n\n\t\t/**\n\t\t * Creates an entity node for each child entity.\n\t\t * @param {sap.ui.model.Context[]} aContexts The binding contexts of the children.\n\t\t * @ignore\n\t\t */\n\t\tlet fnChildren = aContexts => {\n\t\t\tjQuery.each(aContexts, (ii, oC) => this._entity(oModel, oGraph, oC.getPath(), false).then(fnLink));\n\t\t};\n\n\t\t/**\n\t\t * Handles the functionality of loading more children (similar to the growing list).\n\t\t * @param {int} iLength The complete length of the OData collection.\n\t\t * @ignore\n\t\t */\n\t\tlet fnMore = (iLength) => {\n\t\t\tif (oMoreNode) {\n\t\t\t\toMoreNode.setBusy(false);\n\t\t\t\toGraph.removeNode(oMoreNode);\n\t\t\t\toGraph.removeLink(oMoreLink);\n\t\t\t}\n\t\t\tiIndex += iCount;\n\t\t\tif (iIndex < iLength) {\n\t\t\t\tlet sMoreKey = sFull + \"/__more\";\n\t\t\t\toMoreNode = new ODataNode({\n\t\t\t\t\tkey: sMoreKey,\n\t\t\t\t\tlabel: sap.ui.getCore().getLibraryResourceBundle(\"sap.m\").getText(\"LOAD_MORE_DATA\"),\n\t\t\t\t\texpanded: false,\n\t\t\t\t\tentity: sPath,\n\t\t\t\t\texpand: fnRequest\n\t\t\t\t});\n\t\t\t\toMoreLink = new ODataLink({\n\t\t\t\t\tsourceKey: sFull,\n\t\t\t\t\ttargetKey: sMoreKey\n\t\t\t\t});\n\t\t\t\toGraph.addNode(oMoreNode);\n\t\t\t\toGraph.addLink(oMoreLink);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles new received data.\n\t\t * @ignore\n\t\t */\n\t\tlet fnData = () => {\n\t\t\tlet iLength = oBinding.getLength();\n\t\t\tif (!iLength) {\n\t\t\t\toBinding.destroy();\n\t\t\t\toDeferred.resolve();\n\t\t\t} else {\n\t\t\t\tif (iIndex === 0) {\n\t\t\t\t\tfnNode();\n\t\t\t\t}\n\t\t\t\tfnChildren(oBinding.getContexts(iIndex, iCount));\n\t\t\t\tfnMore(iLength);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Triggers a new backend request (if needed).\n\t\t * @ignore\n\t\t */\n\t\tlet fnRequest = () => {\n\t\t\tvar oResult = oBinding.getContexts(iIndex, iCount);\n\t\t\tif (oResult && !oResult.dataRequested) {\n\t\t\t\tfnData();\n\t\t\t} else if (oMoreNode) {\n\t\t\t\toMoreNode.setBusy(true);\n\t\t\t}\n\t\t};\n\n\t\toBinding.attachDataReceived(fnData);\n\t\tfnRequest();\n\n\t\treturn oDeferred.promise();\n\t}\n\n\t/**\n\t * Adds an entity node.\n\t * @private\n\t * @method spet.data.explorer.ODataExplorer#_entity\n\t * @param {sap.ui.model.odata.v2.ODataModel} oModel The OData model.\n\t * @param {spet.data.explorer.Graph} oGraph The Graph control.\n\t * @param {string} sPath The path towards the entity.\n\t * @param {boolean} bOrigin Flag indicating if the node is a root.\n\t * @returns {Promise} A promise resolved when the node is added to the graph.\n\t */\n\t_entity(oModel, oGraph, sPath, bOrigin) {\n\t\tlet oMeta = oModel && oModel.getMetaModel(),\n\t\t\toDeferred = new jQuery.Deferred();\n\n\t\t/**\n\t\t * Gets the title of a node (based on annotations or entity type name).\n\t\t * @returns {string} The title of the node.\n\t\t * @ignore\n\t\t */\n\t\tlet fnTitle = () => {\n\t\t\tlet oMetaCtxt = oMeta.getMetaContext(sPath),\n\t\t\t\tsAnnotationPath = oMetaCtxt.getPath() + \"/com.sap.vocabularies.UI.v1.HeaderInfo/Title\",\n\t\t\t\toMdlCtxt = oMeta.createBindingContext(sAnnotationPath);\n\t\t\treturn (oMdlCtxt && AnnotationHelper.format(oMdlCtxt)) || oMetaCtxt.getProperty(\"name\");\n\t\t};\n\n\t\t/**\n\t\t * Creates a link between the current entity and a child node.\n\t\t * @param {spet.data.explorer.Node} oChild The child node.\n\t\t * @param {string=} sLabel Optional label for the created link.\n\t\t * @returns {spet.data.explorer.Link|null} The created link.\n\t\t * @ignore\n\t\t */\n\t\tlet fnLink = (oChild, sLabel) => oChild && this._link(oGraph, sPath, oChild.getKey(), sLabel);\n\n\t\t/**\n\t\t * Retrieves the label for a navigation.\n\t\t * @param {string} sNavigation The navigation property name.\n\t\t * @param {string} sMetaPath The path in the meta model of the entity.\n\t\t * @returns {string} The navigation label (based on the annotations or property name).\n\t\t * @ignore\n\t\t */\n\t\tlet fnNavigationLabel = (sNavigation, sMetaPath) => {\n\t\t\tlet sAnnotationPath = sMetaPath + \"/com.sap.vocabularies.Common.v1.Label\",\n\t\t\t\toMdlCtxt = oMeta.createBindingContext(sAnnotationPath);\n\t\t\treturn (oMdlCtxt && AnnotationHelper.format(oMdlCtxt)) || oMeta.getProperty(sMetaPath + \"/name\");\n\t\t};\n\n\t\t/**\n\t\t * Adds a related entity.\n\t\t * @param {string} sNavigation The navigation name.\n\t\t * @param {string} sLabel The label to be displayed on the link.\n\t\t * @param {Promise} oBarrier The barrier promise (resolved when all related nodes are loaded).\n\t\t * @returns {Promise} A primise which is resolved when the node is added and linked.\n\t\t * @ignore\n\t\t */\n\t\tlet fnRelated = (sNavigation, sLabel, oBarrier) => {\n\t\t\tlet oPromise = this._entity(oModel, oGraph, sPath + \"/\" + sNavigation, false);\n\t\t\tjQuery.when(oPromise, oBarrier).then(oChild => fnLink(oChild, sLabel));\n\t\t\treturn oPromise;\n\t\t};\n\n\t\t/**\n\t\t * Handles the (first) expand event of a node.\n\t\t * @param {sap.ui.base.Event} oEvent The UI5 event.\n\t\t * @ignore\n\t\t */\n\t\tlet fnExpand = (oEvent) => {\n\t\t\tlet oMetaCtxt = oMeta.getMetaContext(sPath),\n\t\t\t\tsMetaPath = oMetaCtxt.getPath(),\n\t\t\t\toEntity = oMetaCtxt.getObject(),\n\t\t\t\toBarrier = new jQuery.Deferred(),\n\t\t\t\toNode = oEvent.getSource(),\n\t\t\t\taPromises = jQuery.map((oEntity.navigationProperty || []), (oNav, i) => {\n\t\t\t\t\tlet oAssoc = oMeta.getODataAssociationEnd(oEntity, oNav.name),\n\t\t\t\t\t\tsLabel = fnNavigationLabel(oNav.name, sMetaPath + \"/navigationProperty/\" + i),\n\t\t\t\t\t\toPromise;\n\t\t\t\t\tif (!this.fireEvent(\"addNavigation\", { entityPath: sPath, navigationName: oNav.name }, true)) {\n\t\t\t\t\t\toPromise = jQuery.when();\n\t\t\t\t\t} else if (oAssoc.multiplicity.indexOf(\"*\") >= 0) {\n\t\t\t\t\t\toPromise = this._aggregation(oModel, oGraph, sPath, oNav.name, sLabel);\n\t\t\t\t\t\tjQuery.when(oPromise, oBarrier).then(fnLink);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toPromise = fnRelated(oNav.name, sLabel, oBarrier);\n\t\t\t\t\t}\n\t\t\t\t\treturn oPromise;\n\t\t\t\t});\n\t\t\tjQuery.when(...aPromises).then(() => oBarrier.resolve());\n\t\t\toNode.setBusy(true);\n\t\t\toBarrier.then(() => oNode.setBusy(false));\n\t\t};\n\n\t\t/**\n\t\t * Adds the node to the graph and updates the path (makes it absolute).\n\t\t * @param {spet.data.explorer.Node} oNode The node to be added.\n\t\t * @param {sap.ui.model.Context} oContext The context of the node.\n\t\t * @ignore\n\t\t */\n\t\tlet fnAdd = (oNode, oContext) => {\n\t\t\tsPath = oContext.getPath();\n\t\t\toNode.setKey(sPath);\n\t\t\toNode.setEntity(sPath);\n\t\t\tif (this.fireEvent(\"addEntity\", { entityPath: sPath, node: oNode}, true)) {\n\t\t\t\toGraph.addNode(oNode);\n\t\t\t\toDeferred.resolve(oNode);\n\t\t\t} else {\n\t\t\t\toDeferred.resolve();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates the node for the current entity.\n\t\t * @ignore\n\t\t */\n\t\tlet fnCreate = () => {\n\t\t\tlet oNode = new ODataNode({\n\t\t\t\torigin: bOrigin || false,\n\t\t\t\tlabel: fnTitle(),\n\t\t\t\texpanded: false\n\t\t\t});\n\t\t\toNode.bindElement(sPath);\n\t\t\toNode.setModel(oModel);\n\t\t\toNode.attachEventOnce(\"expand\", fnExpand);\n\t\t\toNode.attachEvent(\"detail\", oE => {\n\t\t\t\tthis.fireEvent(\"detailEntity\", {dom: oE.getParameter(\"dom\"), entityPath: sPath});\n\t\t\t});\n\n\t\t\tlet oBinding = oNode.getElementBinding();\n\n\t\t\tlet fnCheck = () => {\n\t\t\t\tvar oContext = oBinding.getBoundContext();\n\t\t\t\tif (oBinding.getBoundContext()) {\n\t\t\t\t\tfnAdd(oNode, oContext);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tif (!fnCheck()) {\n\t\t\t\toBinding.attachEventOnce(\"dataReceived\", () => {\n\t\t\t\t\tif (!fnCheck()) {\n\t\t\t\t\t\toDeferred.resolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif (oMeta) {\n\t\t\toMeta.loaded().then(fnCreate);\n\t\t}\n\n\t\treturn oDeferred.promise();\n\t}\n\n\tinit() {\n\t\tvar oDeferred = new jQuery.Deferred();\n\t\tthis._modelPromise = oDeferred.promise();\n\t\tthis.setAggregation(\"_graph\", new Graph({ directed: true }));\n\t\tthis.attachModelContextChange(() => {\n\t\t\tlet sName = this.getModelName(),\n\t\t\t\toComponent = Component.getOwnerComponentFor(this),\n\t\t\t\toModel = this.getModel(sName) || (oComponent && oComponent.getModel(sName));\n\t\t\tif (oModel) {\n\t\t\t\toDeferred.resolve(oModel);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetPath(sPath) {\n\t\tvar oGraph = this.getAggregation(\"_graph\");\n\t\toGraph.removeAllAggregation(\"nodes\");\n\t\toGraph.removeAllAggregation(\"links\");\n\t\tthis.setProperty(\"path\", sPath);\n\t\tthis._modelPromise.then(oModel => this._entity(oModel, oGraph, sPath, true));\n\t\treturn this;\n\t}\n\n\t/**\n\t * The renderer of the control. Wraps the graph inside a DIV.\n\t * @ignore\n\t * @param {sap.ui.core.RenderManager} oRM The render manager.\n\t * @param {sap.ui.core.Control} oControl The explorer.\n\t * @returns {void}\n\t */\n\trenderer(oRM, oControl) {\n\t\toRM.write(\"<div\");\n\t\toRM.writeControlData(oControl);\n\t\toRM.addStyle(\"height\", oControl.getHeight());\n\t\toRM.addStyle(\"width\", oControl.getWidth());\n\t\toRM.writeStyles();\n\t\toRM.write(\">\");\n\t\toRM.renderControl(oControl.getAggregation(\"_graph\"));\n\t\toRM.write(\"</div>\");\n\t}\n}"]}